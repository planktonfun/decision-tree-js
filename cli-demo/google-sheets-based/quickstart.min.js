var fs=require("fs"),readline=require("readline"),google=require("googleapis"),googleAuth=require("google-auth-library"),SCOPES=["https://www.googleapis.com/auth/spreadsheets.readonly"],TOKEN_DIR=(process.env.HOME||process.env.HOMEPATH||process.env.USERPROFILE)+"/.credentials/",TOKEN_PATH=TOKEN_DIR+"sheets.googleapis.com-nodejs-quickstart.json";
function authorize(a,d){var b=a.installed.client_secret,c=a.installed.client_id,e=a.installed.redirect_uris[0],b=new (new googleAuth).OAuth2(c,b,e);try{var f=fs.readFile(TOKEN_PATH,"utf8");b.credentials=JSON.parse(f);d(b)}catch(g){getNewToken(b,d)}}
function getNewToken(a,d){var b=a.generateAuthUrl({access_type:"offline",scope:SCOPES});console.log("Authorize this app by visiting this url: ",b);var c=readline.createInterface({input:process.stdin,output:process.stdout});c.question("Enter the code from that page here: ",function(b){c.close();a.getToken(b,function(b,c){b?console.log("Error while trying to retrieve access token",b):(a.credentials=c,storeToken(c),d(a))})})}
function storeToken(a){try{fs.mkdirSync(TOKEN_DIR)}catch(d){if("EEXIST"!=d.code)throw d;}fs.writeFile(TOKEN_PATH,JSON.stringify(a));console.log("Token stored to "+TOKEN_PATH)}
function listMajors(a){google.sheets("v4").spreadsheets.values.get({auth:a,spreadsheetId:"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms",range:"Class Data!A2:E"},function(a,b){if(a)console.log("The API returned an error: "+a);else{var c=b.values;if(0==c.length)console.log("No data found.");else{console.log("Name, Major:");for(var e=0;e<c.length;e++){var f=c[e];console.log("%s, %s",f[0],f[4])}}}})}
var init=function(){var a=fs.readFileSync("client_id.json","utf8");authorize(JSON.parse(a));console.log(1);return google};exports.init=init;
